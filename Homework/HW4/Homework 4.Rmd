---
title: "Homework 4"
author: "Gianni Spiga"
date: "5/10/2022"
output: html_document
---

### P1 
6.8.)
a.)
```{r}
tr1 <- matrix(c(6, 7, 5, 9, 8, 6, 4, 9, 7, 9), nrow = 2, ncol = 5)
tr1

tr2 <- matrix(c(3, 3, 1, 6, 2, 3), nrow = 2, ncol = 3)
tr2

tr3 <- matrix(c(2, 3, 5, 1, 3, 1, 2, 3), nrow = 2, ncol = 4)
tr3

xbar1 <- rowMeans(tr1)
xbar1

xbar2 <- rowMeans(tr2)
xbar2

xbar3 <- rowMeans(tr3)
xbar3


#xl1 <- rbind(tr1[1,], tr2[2,], tr3[3,])

xbar <-
  c((ncol(tr1) * xbar1[1] + ncol(tr2) * xbar2[1] + ncol(tr3) * xbar3[1]) / (ncol(tr1) + ncol(tr2) + ncol(tr3)),
    ((ncol(tr1) * xbar1[2]) + (ncol(tr2) * xbar2[2]) + (ncol(tr3) * xbar3[2])) / (ncol(tr1) + ncol(tr2) + ncol(tr3))
  )
xbar


#cat("=", )

#xbarl1 <- matrix(4, nrow = 3, ncol = 5) +
# cat("=") 
# matrix(4, nrow = 3, ncol = 5)
# print('+' )
# matrix(c(2,-2,-1), nrow = 3, ncol =5)
# print('+')
# matrix(c(2,-2,-1), nrow = 3, ncol =5)
```


$$
x_{1j} = \begin{pmatrix}
4 & 4 & 4 & 4 & 4 \\
4 & 4 & 4 &\\
4 &4 &4 &4 &\\
\end{pmatrix} + \begin{pmatrix}
2 & 2 & 2 & 2 & 2 \\
-2 & -2 & -2 &\\
-1 & -1 & -1 & -1 &\\
\end{pmatrix} + \begin{pmatrix}
0 & -1 & 2 & -2 & 1 \\
1 & -1 & 0 &\\
-1 & 2 & 0 & -1 &\\
\end{pmatrix}
$$
$$
x_{2j} = \begin{pmatrix}
5 & 5 & 5 & 5 & 5 \\
5 & 5 & 5 &\\
5 &5 &5 &5 &\\
\end{pmatrix} + \begin{pmatrix}
3 & 3 & 3 & 3 & 3 \\
-1 & -1 & -1 &\\
-3 & -3 & -3 & -3 &\\
\end{pmatrix} + \begin{pmatrix}
-1 & 1 & -2 & 1 & 1 \\
-1 & 2 & -1 &\\
-1 & 2 & 0 & -1 &\\
\end{pmatrix}
$$

b.)
Variable 1
```{r}
mat1 <- rbind(tr1[1,], c(tr2[1,], rep(0, 2)), c(tr3[1,], 0))
mat1

SSobs1 <- sum(mat1 ^ 2)
SSobs1

SSmean1 <- xbar[1] ^ 2 * 12
SSmean1

SStrt1 <-
  ncol(tr1) * (mean(tr1[1,] - xbar[1])) ^ 2 + ncol(tr2) * (mean(tr2[1,] - xbar[1])) ^
  2 + ncol(tr3) * (mean(tr3[1,] - xbar[1])) ^ 2
SStrt1

SSres1 <-
  sum((mat1 - rbind(rep(xbar1[1], 5),
                    c(rep(
                      xbar2[1], 3
                    ), 0 , 0),
                    c(rep(
                      xbar3[1], 4
                    ), 0))) ^ 2)
SSres1

SStotal1 <- SSobs1 - SSmean1
SStotal1
```
Variable 2 
```{r}
mat2 <- rbind(tr1[2,], c(tr2[2,], rep(0, 2)), c(tr3[2,], 0))
SSobs2 <- sum(mat2 ^ 2)
SSobs2

SSmean2 <- xbar[2] ^ 2 * 12
SSmean2

SStrt2 <-
  ncol(tr1) * (mean(tr1[2,] - xbar[2])) ^ 2 + ncol(tr2) * (mean(tr2[2,] - xbar[2])) ^
  2 + ncol(tr3) * (mean(tr3[2,] - xbar[2])) ^ 2
SStrt2

SSres2 <-
  sum((mat2 - rbind(rep(xbar1[2], 5),
                    c(rep(
                      xbar2[2], 3
                    ), 0 , 0),
                    c(rep(
                      xbar3[2], 4
                    ), 0))) ^ 2)
SSres2

SStotal2 <- SSobs2 - SSmean2
SStotal2
```

Cross Product 
```{r}
SSobs_x <- sum(mat1 * mat2)
SSobs_x

SSmean_x <- xbar[1] * xbar[2] * 12
SSmean_x

SStrt_x <- ncol(tr1) *  (mean(tr1[1,] - xbar[1]))* (mean(tr1[2,] - xbar[2])) + ncol(tr2) * (mean(tr2[1,] - xbar[1])) * (mean(tr2[2,] - xbar[2])) + ncol(tr3) * (mean(tr3[1,] - xbar[1]))* (mean(tr3[2,] - xbar[2]))
SStrt_x

SSres_x <- sum((mat2 - rbind(rep(xbar1[2], 5), c(rep( xbar2[2], 3), 0 , 0),
                    c(rep(xbar3[2], 4
                    ), 0))) * (mat1 - rbind(rep(xbar1[1], 5),
                    c(rep(
                      xbar2[1], 3
                    ), 0 , 0),
                    c(rep(
                      xbar3[1], 4
                    ), 0))))
SSres_x

SStotal_x <- SSobs_x - SSmean_x
SStotal_x
```

```{r}
cat("Treatment \n")
B <- matrix(c(SStrt1, SStrt_x, SStrt_x, SStrt2), nrow = 2, ncol = 2)
B
dfB <- nrow(mat1)-1
dfB

cat("Residuals \n")
W <- matrix(c(SSres1, SSres_x, SSres_x, SSres2), nrow = 2, ncol = 2)
W
dfW <- 12 - 3
dfW

cat("Total \n")
B + W
#df
12 - 1

```

c.)
```{r}
WLambda <- det(W) / det(W + B)
WLambda

#Test stat
((12 - nrow(mat1) - 1) / (nrow(mat1) - 1)) * ((1 - sqrt(WLambda)) / sqrt(WLambda))

#Critical value
qf(0.01, df1 = 2 * nrow(tr1), df2 = 2 *(12 - nrow(tr1) - 2), lower.tail = FALSE)
```

Since our critical value is less than our test statistic, we reject $H_0$ when $\alpha = 0.01$. We have statistical evidence to conclude at least one $\tau_i$ is not 0. 

Barlett's correction
```{r}
#Test statistic
- (12 - 1 - ((nrow(tr1) + nrow(mat1))/2)) * log(WLambda)

#Critical Value
qchisq(0.01, df = nrow(tr1) * (nrow(mat1)-1), lower.tail = FALSE)

```
Since our critical value is once again less than our test statistic, we reject $H_0$. This conclusion lines up with the conclusion we made using Wilk's Lambda. 
While both are adequite in the case of small sample sizes, Bartlett's correction improves accuracy for large sample sizes. 

P2
6.13.)

```{r}
tr1 <- matrix(c(6, 4, 8, 2, 3, -3, 4, -4, -3, -4, 3, -4), nrow = 3, ncol = 4, byrow = TRUE)
tr1

tr2 <- matrix(c(8,6,12,6,8,2,3,3,2,-5,-3,-6), nrow = 3, ncol = 4, byrow = TRUE)
tr2

xbar1 <- mean(tr1)
xbar1

xbar2 <- mean(tr2)
xbar2

xbar <- matrix(xbar1, nrow = 3, ncol = 4)
xbar

factef1 <- rowMeans(tr1) - matrix(xbar1, nrow = 3, ncol = 4)
factef1

factef2 <- matrix(c(rep(colMeans(tr1) - xbar1, 3)), nrow = 3, ncol = 4, byrow = TRUE) 
factef2

resid1 <- tr1 - factef1 - factef2 - xbar
resid1

```

```{r}
tr1 <- matrix(c(6, 4, 8, 2, 3, -3, 4, -4, -3, -4, 3, -4), nrow = 3, ncol = 4, byrow = TRUE)
tr1

tr2 <- matrix(c(8,6,12,6,8,2,3,3,2,-5,-3,-6), nrow = 3, ncol = 4, byrow = TRUE)
tr2

xbar1 <- mean(tr1)
xbar1

xbar2 <- mean(tr2)
xbar2

xbar <- matrix(xbar1, nrow = 3, ncol = 4)
xbar

factef1 <- rowMeans(tr1) - matrix(xbar1, nrow = 3, ncol = 4)
factef1

factef2 <- matrix(c(rep(colMeans(tr1) - xbar1, 3)), nrow = 3, ncol = 4, byrow = TRUE) 
factef2

resid1 <- tr1 - factef1 - factef2 - xbar
resid1


SSmean1 <- sum(xbar)
SSmean1

SSfac1 <- sum(factef1^2)
SSfac1

SSfac2 <- sum(factef2^2)
SSfac2

SSres <- sum(resid1 ^2)
SSres
```
